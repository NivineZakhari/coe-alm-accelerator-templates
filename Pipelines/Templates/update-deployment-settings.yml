parameters:
- name: orgUrl
  type: string
- name: projectName
  type: string
- name: repo
  type: string
- name: serviceConnection
  type: string
- name: solutionName
  type: string
- name: profileEnvironmentUrl
  type: string
- name: profileId
  type: string
- name: configurationData
  type: string
- name: generateEnvironmentVariables
  type: string
  default: 'true'
- name: generateConnectionReferences
  type: string
  default: 'true'
- name: generateOwnershipConfig
  type: string
  default: 'true'
- name: generateCanvasSharingConfig
  type: string
  default: 'true'
- name: generateAADGroupTeamConfig
  type: string
  default: 'false'
- name: generateCustomConnectorConfig
  type: string
  default: 'false'
- name: overwriteExisting
  type: string
  default: 'false'

steps:
- powershell: |
      # load PowerShell files into memory
      . "$env:POWERSHELLPATH/update-deployment-settings.ps1"
      Set-DeploymentSettingsConfiguration '$(Build.SourcesDirectory)' '$(Build.Repository.Name)' '$(CdsBaseConnectionString)' '$(XrmDataPowerShellVersion)' '$(CoETools_Microsoft_Xrm_Data_PowerShell)' '${{parameters.orgUrl}}' '$(System.TeamProjectId)' '${{parameters.projectName}}' '${{parameters.repo}}' 'Bearer' '$env:SYSTEM_ACCESSTOKEN' '${{parameters.serviceConnection}}' '${{parameters.solutionName}}' '${{parameters.profileEnvironmentUrl}}' '${{parameters.profileId}}' '${{parameters.configurationData}}'
  env:
    SYSTEM_ACCESSTOKEN: $(System.AccessToken)
  displayName: 'Update Deployment Settings'
  condition: succeeded()
